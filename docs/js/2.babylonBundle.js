(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{102:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var o=i(30),s=i(36),n=i(43),r=i(168),a=i(34);n.a.CreateLineSystem=function(t){for(var e=[],i=[],o=t.lines,s=t.colors,r=[],a=0,h=0;h<o.length;h++)for(var c=o[h],p=0;p<c.length;p++){if(i.push(c[p].x,c[p].y,c[p].z),s){var u=s[h];r.push(u[p].r,u[p].g,u[p].b,u[p].a)}p>0&&(e.push(a-1),e.push(a)),a++}var l=new n.a;return l.indices=e,l.positions=i,s&&(l.colors=r),l},n.a.CreateDashedLines=function(t){var e,i,s=t.dashSize||3,r=t.gapSize||1,a=t.dashNb||200,h=t.points,c=new Array,p=new Array,u=o.e.Zero(),l=0,d=0,f=0,y=0,m=0;for(m=0;m<h.length-1;m++)h[m+1].subtractToRef(h[m],u),l+=u.length();for(i=s*(e=l/a)/(s+r),m=0;m<h.length-1;m++){h[m+1].subtractToRef(h[m],u),d=Math.floor(u.length()/e),u.normalize();for(var g=0;g<d;g++)f=e*g,c.push(h[m].x+f*u.x,h[m].y+f*u.y,h[m].z+f*u.z),c.push(h[m].x+(f+i)*u.x,h[m].y+(f+i)*u.y,h[m].z+(f+i)*u.z),p.push(y,y+1),y+=2}var _=new n.a;return _.positions=c,_.indices=p,_},s.a.CreateLines=function(t,e,i,o,s){void 0===i&&(i=null),void 0===o&&(o=!1),void 0===s&&(s=null);var n={points:e,updatable:o,instance:s};return h.CreateLines(t,n,i)},s.a.CreateDashedLines=function(t,e,i,o,s,n,r,a){void 0===n&&(n=null);var c={points:e,dashSize:i,gapSize:o,dashNb:s,updatable:r,instance:a};return h.CreateDashedLines(t,c,n)};var h=function(){function t(){}return t.CreateLineSystem=function(t,e,i){var o=e.instance,s=e.lines,h=e.colors;if(o){var c,p,u=o.getVerticesData(a.b.PositionKind);h&&(c=o.getVerticesData(a.b.ColorKind));for(var l=0,d=0,f=0;f<s.length;f++)for(var y=s[f],m=0;m<y.length;m++)u[l]=y[m].x,u[l+1]=y[m].y,u[l+2]=y[m].z,h&&c&&(p=h[f],c[d]=p[m].r,c[d+1]=p[m].g,c[d+2]=p[m].b,c[d+3]=p[m].a,d+=4),l+=3;return o.updateVerticesData(a.b.PositionKind,u,!1,!1),h&&c&&o.updateVerticesData(a.b.ColorKind,c,!1,!1),o}var g=!!h,_=new r.b(t,i,null,void 0,void 0,g,e.useVertexAlpha);return n.a.CreateLineSystem(e).applyToMesh(_,e.updatable),_},t.CreateLines=function(e,i,o){void 0===o&&(o=null);var s=i.colors?[i.colors]:null;return t.CreateLineSystem(e,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:s,useVertexAlpha:i.useVertexAlpha},o)},t.CreateDashedLines=function(t,e,i){void 0===i&&(i=null);var a=e.points,h=e.instance,c=e.gapSize||1,p=e.dashSize||3;if(h){return h.updateMeshPositions((function(t){var e,i,s=o.e.Zero(),n=t.length/6,r=0,c=0,p=0,u=0,l=0,d=0;for(l=0;l<a.length-1;l++)a[l+1].subtractToRef(a[l],s),r+=s.length();e=r/n;var f=h._creationDataStorage.dashSize;for(i=f*e/(f+h._creationDataStorage.gapSize),l=0;l<a.length-1;l++)for(a[l+1].subtractToRef(a[l],s),c=Math.floor(s.length()/e),s.normalize(),d=0;d<c&&u<t.length;)p=e*d,t[u]=a[l].x+p*s.x,t[u+1]=a[l].y+p*s.y,t[u+2]=a[l].z+p*s.z,t[u+3]=a[l].x+(p+i)*s.x,t[u+4]=a[l].y+(p+i)*s.y,t[u+5]=a[l].z+(p+i)*s.z,u+=6,d++;for(;u<t.length;)t[u]=a[l].x,t[u+1]=a[l].y,t[u+2]=a[l].z,u+=3}),!1),h}var u=new r.b(t,i,null,void 0,void 0,void 0,e.useVertexAlpha);return n.a.CreateDashedLines(e).applyToMesh(u,e.updatable),u._creationDataStorage=new s.b,u._creationDataStorage.dashSize=p,u._creationDataStorage.gapSize=c,u},t}()},115:function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var o=i(4),s=i(99),n=i(30),r=i(50),a=i(36),h=i(124),c=i(64);a.a._PhysicsImpostorParser=function(t,e,i){return new p(e,i.physicsImpostor,{mass:i.physicsMass,friction:i.physicsFriction,restitution:i.physicsRestitution},t)};var p=function(){function t(t,e,i,s){var r=this;void 0===i&&(i={mass:0}),this.object=t,this.type=e,this._options=i,this._scene=s,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=n.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new n.b,this._tmpQuat2=new n.b,this.beforeStep=function(){r._physicsEngine&&(r.object.translate(r._deltaPosition,-1),r._deltaRotationConjugated&&r.object.rotationQuaternion&&r.object.rotationQuaternion.multiplyToRef(r._deltaRotationConjugated,r.object.rotationQuaternion),r.object.computeWorldMatrix(!1),r.object.parent&&r.object.rotationQuaternion?(r.getParentsRotation(),r._tmpQuat.multiplyToRef(r.object.rotationQuaternion,r._tmpQuat)):r._tmpQuat.copyFrom(r.object.rotationQuaternion||new n.b),r._options.disableBidirectionalTransformation||r.object.rotationQuaternion&&r._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(r,r.object.getAbsolutePosition(),r._tmpQuat),r._onBeforePhysicsStepCallbacks.forEach((function(t){t(r)})))},this.afterStep=function(){r._physicsEngine&&(r._onAfterPhysicsStepCallbacks.forEach((function(t){t(r)})),r._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(r),r.object.parent&&r.object.rotationQuaternion&&(r.getParentsRotation(),r._tmpQuat.conjugateInPlace(),r._tmpQuat.multiplyToRef(r.object.rotationQuaternion,r.object.rotationQuaternion)),r.object.setAbsolutePosition(r.object.position),r._deltaRotation&&r.object.rotationQuaternion&&r.object.rotationQuaternion.multiplyToRef(r._deltaRotation,r.object.rotationQuaternion),r.object.translate(r._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(t){if((r._onPhysicsCollideCallbacks.length||r.onCollideEvent)&&r._physicsEngine){var e=r._physicsEngine.getImpostorWithPhysicsBody(t.body);e&&(r.onCollideEvent&&r.onCollideEvent(r,e),r._onPhysicsCollideCallbacks.filter((function(t){return-1!==t.otherImpostors.indexOf(e)})).forEach((function(t){t.callback(r,e)})))}},this.object?(this.object.parent&&0!==i.mass&&o.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&t.getScene&&(this._scene=t.getScene()),this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=n.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new n.b),this._options.mass=void 0===i.mass?0:i.mass,this._options.friction=void 0===i.friction?.2:i.friction,this._options.restitution=void 0===i.restitution?.2:i.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=void 0===i.pressure?200:i.pressure,this._options.stiffness=void 0===i.stiffness?1:i.stiffness,this._options.velocityIterations=void 0===i.velocityIterations?20:i.velocityIterations,this._options.positionIterations=void 0===i.positionIterations?20:i.positionIterations,this._options.fixedPoints=void 0===i.fixedPoints?0:i.fixedPoints,this._options.margin=void 0===i.margin?0:i.margin,this._options.damping=void 0===i.damping?0:i.damping,this._options.path=void 0===i.path?null:i.path,this._options.shape=void 0===i.shape?null:i.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&o.a.Warn("You must affect impostors to children before affecting impostor to parent.")):o.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):o.a.Error("No object was provided. A physics object is obligatory")}return Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(t){this.setMass(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.setBodyPressure?t.getBodyPressure(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyPressure&&e.setBodyPressure(this,t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyStiffness?t.getBodyStiffness(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyStiffness&&e.setBodyStiffness(this,t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyVelocityIterations?t.getBodyVelocityIterations(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyVelocityIterations&&e.setBodyVelocityIterations(this,t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var t=this._physicsEngine.getPhysicsPlugin();return t.getBodyPositionIterations?t.getBodyPositionIterations(this):0},set:function(t){if(this._physicsEngine){var e=this._physicsEngine.getPhysicsPlugin();e.setBodyPositionIterations&&e.setBodyPositionIterations(this,t)}},enumerable:!0,configurable:!0}),t.prototype._init=function(){this._physicsEngine&&(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this._isDisposed||this.parent&&!this._options.ignoreParent||this._physicsEngine.addImpostor(this))},t.prototype._getPhysicsParent=function(){return this.object.parent instanceof r.a?this.object.parent.physicsImpostor:null},t.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},t.prototype.setScalingUpdated=function(){this.forceUpdate()},t.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(t.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(t){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=t,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(t){this._parent=t},enumerable:!0,configurable:!0}),t.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},t.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var e=this.object.rotationQuaternion;this.object.rotationQuaternion=t.IDENTITY_QUATERNION,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);var i=this.object.getBoundingInfo().boundingBox.extendSizeWorld.scale(2);return this.object.rotationQuaternion=e,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),i}return t.DEFAULT_OBJECT_SIZE},t.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.centerWorld:this.object.position},t.prototype.getParam=function(t){return this._options[t]},t.prototype.setParam=function(t,e){this._options[t]=e,this._bodyUpdateRequired=!0},t.prototype.setMass=function(t){this.getParam("mass")!==t&&this.setParam("mass",t),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,t)},t.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):n.e.Zero()},t.prototype.setLinearVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,t)},t.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):n.e.Zero()},t.prototype.setAngularVelocity=function(t){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,t)},t.prototype.executeNativeFunction=function(t){this._physicsEngine&&t(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},t.prototype.registerBeforePhysicsStep=function(t){this._onBeforePhysicsStepCallbacks.push(t)},t.prototype.unregisterBeforePhysicsStep=function(t){var e=this._onBeforePhysicsStepCallbacks.indexOf(t);e>-1?this._onBeforePhysicsStepCallbacks.splice(e,1):o.a.Warn("Function to remove was not found")},t.prototype.registerAfterPhysicsStep=function(t){this._onAfterPhysicsStepCallbacks.push(t)},t.prototype.unregisterAfterPhysicsStep=function(t){var e=this._onAfterPhysicsStepCallbacks.indexOf(t);e>-1?this._onAfterPhysicsStepCallbacks.splice(e,1):o.a.Warn("Function to remove was not found")},t.prototype.registerOnPhysicsCollide=function(t,e){var i=t instanceof Array?t:[t];this._onPhysicsCollideCallbacks.push({callback:e,otherImpostors:i})},t.prototype.unregisterOnPhysicsCollide=function(t,e){var i=t instanceof Array?t:[t],s=-1;this._onPhysicsCollideCallbacks.some((function(t,o){if(t.callback===e&&t.otherImpostors.length===i.length){var n=t.otherImpostors.every((function(t){return i.indexOf(t)>-1}));return n&&(s=o),n}return!1}))?this._onPhysicsCollideCallbacks.splice(s,1):o.a.Warn("Function to remove was not found")},t.prototype.getParentsRotation=function(){var t=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);t;)t.rotationQuaternion?this._tmpQuat2.copyFrom(t.rotationQuaternion):n.b.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,t.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),t=t.parent;return this._tmpQuat},t.prototype.applyForce=function(t,e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,t,e),this},t.prototype.applyImpulse=function(t,e){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,t,e),this},t.prototype.createJoint=function(t,e,i){var o=new h.a(e,i);return this.addJoint(t,o),this},t.prototype.addJoint=function(t,e){return this._joints.push({otherImpostor:t,joint:e}),this._physicsEngine&&this._physicsEngine.addJoint(this,t,e),this},t.prototype.addAnchor=function(t,e,i,o,s){if(!this._physicsEngine)return this;var n=this._physicsEngine.getPhysicsPlugin();return n.appendAnchor?(this._physicsEngine&&n.appendAnchor(this,t,e,i,o,s),this):this},t.prototype.addHook=function(t,e,i,o){if(!this._physicsEngine)return this;var s=this._physicsEngine.getPhysicsPlugin();return s.appendAnchor?(this._physicsEngine&&s.appendHook(this,t,e,i,o),this):this},t.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},t.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},t.prototype.clone=function(e){return e?new t(e,this.type,this._options,this._scene):null},t.prototype.dispose=function(){var t=this;this._physicsEngine&&(this._joints.forEach((function(e){t._physicsEngine&&t._physicsEngine.removeJoint(t,e.otherImpostor,e.joint)})),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},t.prototype.setDeltaPosition=function(t){this._deltaPosition.copyFrom(t)},t.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new n.b),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},t.prototype.getBoxSizeToRef=function(t){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,t),this},t.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},t.prototype.syncBoneWithImpostor=function(e,i,o,s,n){var r=t._tmpVecs[0],a=this.object;if(a.rotationQuaternion)if(n){var h=t._tmpQuat;a.rotationQuaternion.multiplyToRef(n,h),e.setRotationQuaternion(h,c.b.WORLD,i)}else e.setRotationQuaternion(a.rotationQuaternion,c.b.WORLD,i);r.x=0,r.y=0,r.z=0,o&&(r.x=o.x,r.y=o.y,r.z=o.z,e.getDirectionToRef(r,i,r),null==s&&(s=o.length()),r.x*=s,r.y*=s,r.z*=s),e.getParent()?(r.addInPlace(a.getAbsolutePosition()),e.setAbsolutePosition(r,i)):(i.setAbsolutePosition(a.getAbsolutePosition()),i.position.x-=r.x,i.position.y-=r.y,i.position.z-=r.z)},t.prototype.syncImpostorWithBone=function(e,i,o,s,n,r){var a=this.object;if(a.rotationQuaternion)if(n){var h=t._tmpQuat;e.getRotationQuaternionToRef(c.b.WORLD,i,h),h.multiplyToRef(n,a.rotationQuaternion)}else e.getRotationQuaternionToRef(c.b.WORLD,i,a.rotationQuaternion);var p=t._tmpVecs[0],u=t._tmpVecs[1];r||((r=t._tmpVecs[2]).x=0,r.y=1,r.z=0),e.getDirectionToRef(r,i,u),e.getAbsolutePositionToRef(i,p),null==s&&o&&(s=o.length()),null!=s&&(p.x+=u.x*s,p.y+=u.y*s,p.z+=u.z*s),a.setAbsolutePosition(p)},t.DEFAULT_OBJECT_SIZE=new n.e(1,1,1),t.IDENTITY_QUATERNION=n.b.Identity(),t._tmpVecs=s.a.BuildArray(3,n.e.Zero),t._tmpQuat=n.b.Identity(),t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CapsuleImpostor=6,t.CylinderImpostor=7,t.ParticleImpostor=8,t.HeightmapImpostor=9,t.ConvexHullImpostor=10,t.CustomImpostor=100,t.RopeImpostor=101,t.ClothImpostor=102,t.SoftbodyImpostor=103,t}()},124:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var o=i(1),s=function(){function t(t,e){this.type=t,this.jointData=e,e.nativeParams=e.nativeParams||{}}return Object.defineProperty(t.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(t){this._physicsJoint,this._physicsJoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"physicsPlugin",{set:function(t){this._physicsPlugin=t},enumerable:!0,configurable:!0}),t.prototype.executeNativeFunction=function(t){t(this._physicsPlugin.world,this._physicsJoint)},t.DistanceJoint=0,t.HingeJoint=1,t.BallAndSocketJoint=2,t.WheelJoint=3,t.SliderJoint=4,t.PrismaticJoint=5,t.UniversalJoint=6,t.Hinge2Joint=t.WheelJoint,t.PointToPointJoint=8,t.SpringJoint=9,t.LockJoint=10,t}(),n=(function(t){function e(e){return t.call(this,s.DistanceJoint,e)||this}Object(o.d)(e,t),e.prototype.updateDistance=function(t,e){this._physicsPlugin.updateDistanceJoint(this,t,e)}}(s),function(t){function e(e,i){return t.call(this,e,i)||this}return Object(o.d)(e,t),e.prototype.setMotor=function(t,e){this._physicsPlugin.setMotor(this,t||0,e)},e.prototype.setLimit=function(t,e){this._physicsPlugin.setLimit(this,t,e)},e}(s));(function(t){function e(e){return t.call(this,s.HingeJoint,e)||this}Object(o.d)(e,t),e.prototype.setMotor=function(t,e){this._physicsPlugin.setMotor(this,t||0,e)},e.prototype.setLimit=function(t,e){this._physicsPlugin.setLimit(this,t,e)}})(n),function(t){function e(e){return t.call(this,s.Hinge2Joint,e)||this}Object(o.d)(e,t),e.prototype.setMotor=function(t,e,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,t||0,e,i)},e.prototype.setLimit=function(t,e,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,t,e,i)}}(n)},130:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var o=i(30),s=i(32),n=i(36),r=i(43),a=i(199),h=i(37),c=i(6),p=i(76),u=i(12);r.a.CreateGround=function(t){var e,i,s=[],n=[],a=[],h=[],c=t.width||1,p=t.height||1,u=t.subdivisionsX||t.subdivisions||1,l=t.subdivisionsY||t.subdivisions||1;for(e=0;e<=l;e++)for(i=0;i<=u;i++){var d=new o.e(i*c/u-c/2,0,(l-e)*p/l-p/2),f=new o.e(0,1,0);n.push(d.x,d.y,d.z),a.push(f.x,f.y,f.z),h.push(i/u,1-e/l)}for(e=0;e<l;e++)for(i=0;i<u;i++)s.push(i+1+(e+1)*(u+1)),s.push(i+1+e*(u+1)),s.push(i+e*(u+1)),s.push(i+(e+1)*(u+1)),s.push(i+1+(e+1)*(u+1)),s.push(i+e*(u+1));var y=new r.a;return y.indices=s,y.positions=n,y.normals=a,y.uvs=h,y},r.a.CreateTiledGround=function(t){var e,i,s,n,a=void 0!==t.xmin&&null!==t.xmin?t.xmin:-1,h=void 0!==t.zmin&&null!==t.zmin?t.zmin:-1,c=void 0!==t.xmax&&null!==t.xmax?t.xmax:1,p=void 0!==t.zmax&&null!==t.zmax?t.zmax:1,u=t.subdivisions||{w:1,h:1},l=t.precision||{w:1,h:1},d=new Array,f=new Array,y=new Array,m=new Array;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;var g=(c-a)/u.w,_=(p-h)/u.h;function b(t,s,n,r){var a=f.length/3,h=l.w+1;for(e=0;e<l.h;e++)for(i=0;i<l.w;i++){var c=[a+i+e*h,a+(i+1)+e*h,a+(i+1)+(e+1)*h,a+i+(e+1)*h];d.push(c[1]),d.push(c[2]),d.push(c[3]),d.push(c[0]),d.push(c[1]),d.push(c[3])}var p=o.e.Zero(),u=new o.e(0,1,0);for(e=0;e<=l.h;e++)for(p.z=e*(r-s)/l.h+s,i=0;i<=l.w;i++)p.x=i*(n-t)/l.w+t,p.y=0,f.push(p.x,p.y,p.z),y.push(u.x,u.y,u.z),m.push(i/l.w,e/l.h)}for(s=0;s<u.h;s++)for(n=0;n<u.w;n++)b(a+n*g,h+s*_,a+(n+1)*g,h+(s+1)*_);var v=new r.a;return v.indices=d,v.positions=f,v.normals=y,v.uvs=m,v},r.a.CreateGroundFromHeightMap=function(t){var e,i,n=[],a=[],h=[],c=[],u=t.colorFilter||new s.a(.3,.59,.11),l=t.alphaFilter||0,d=!1;if(t.minHeight>t.maxHeight){d=!0;var f=t.maxHeight;t.maxHeight=t.minHeight,t.minHeight=f}for(e=0;e<=t.subdivisions;e++)for(i=0;i<=t.subdivisions;i++){var y=new o.e(i*t.width/t.subdivisions-t.width/2,0,(t.subdivisions-e)*t.height/t.subdivisions-t.height/2),m=4*(((y.x+t.width/2)/t.width*(t.bufferWidth-1)|0)+((1-(y.z+t.height/2)/t.height)*(t.bufferHeight-1)|0)*t.bufferWidth),g=t.buffer[m]/255,_=t.buffer[m+1]/255,b=t.buffer[m+2]/255,v=t.buffer[m+3]/255;d&&(g=1-g,_=1-_,b=1-b);var P=g*u.r+_*u.g+b*u.b;y.y=v>=l?t.minHeight+(t.maxHeight-t.minHeight)*P:t.minHeight-p.a,a.push(y.x,y.y,y.z),h.push(0,0,0),c.push(i/t.subdivisions,1-e/t.subdivisions)}for(e=0;e<t.subdivisions;e++)for(i=0;i<t.subdivisions;i++){var A=i+1+(e+1)*(t.subdivisions+1),M=i+1+e*(t.subdivisions+1),x=i+e*(t.subdivisions+1),C=i+(e+1)*(t.subdivisions+1),I=a[3*A+1]>=t.minHeight,S=a[3*M+1]>=t.minHeight,w=a[3*x+1]>=t.minHeight;I&&S&&w&&(n.push(A),n.push(M),n.push(x)),a[3*C+1]>=t.minHeight&&I&&w&&(n.push(C),n.push(A),n.push(x))}r.a.ComputeNormals(a,n,h);var B=new r.a;return B.indices=n,B.positions=a,B.normals=h,B.uvs=c,B},n.a.CreateGround=function(t,e,i,o,s,n){var r={width:e,height:i,subdivisions:o,updatable:n};return l.CreateGround(t,r,s)},n.a.CreateTiledGround=function(t,e,i,o,s,n,r,a,h){var c={xmin:e,zmin:i,xmax:o,zmax:s,subdivisions:n,precision:r,updatable:h};return l.CreateTiledGround(t,c,a)},n.a.CreateGroundFromHeightMap=function(t,e,i,o,s,n,r,a,h,c,p){var u={width:i,height:o,subdivisions:s,minHeight:n,maxHeight:r,updatable:h,onReady:c,alphaFilter:p};return l.CreateGroundFromHeightMap(t,e,u,a)};var l=function(){function t(){}return t.CreateGround=function(t,e,i){var o=new a.a(t,i);return o._setReady(!1),o._subdivisionsX=e.subdivisionsX||e.subdivisions||1,o._subdivisionsY=e.subdivisionsY||e.subdivisions||1,o._width=e.width||1,o._height=e.height||1,o._maxX=o._width/2,o._maxZ=o._height/2,o._minX=-o._maxX,o._minZ=-o._maxZ,r.a.CreateGround(e).applyToMesh(o,e.updatable),o._setReady(!0),o},t.CreateTiledGround=function(t,e,i){void 0===i&&(i=null);var o=new n.a(t,i);return r.a.CreateTiledGround(e).applyToMesh(o,e.updatable),o},t.CreateGroundFromHeightMap=function(t,e,i,o){void 0===o&&(o=null);var n=i.width||10,p=i.height||10,l=i.subdivisions||1,d=i.minHeight||0,f=i.maxHeight||1,y=i.colorFilter||new s.a(.3,.59,.11),m=i.alphaFilter||0,g=i.updatable,_=i.onReady;o=o||c.a.LastCreatedScene;var b=new a.a(t,o);b._subdivisionsX=l,b._subdivisionsY=l,b._width=n,b._height=p,b._maxX=b._width/2,b._maxZ=b._height/2,b._minX=-b._maxX,b._minZ=-b._maxZ,b._setReady(!1);return h.b.LoadImage(e,(function(t){var e=t.width,i=t.height,s=u.a.CreateCanvas(e,i).getContext("2d");if(!s)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!o.isDisposed){s.drawImage(t,0,0);var a=s.getImageData(0,0,e,i).data;r.a.CreateGroundFromHeightMap({width:n,height:p,subdivisions:l,minHeight:d,maxHeight:f,colorFilter:y,buffer:a,bufferWidth:e,bufferHeight:i,alphaFilter:m}).applyToMesh(b,g),_&&_(b),b._setReady(!0)}}),(function(){}),o.offlineProvider),b},t}()},131:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var o=i(30),s=i(36),n=i(34),r=i(43),a=i(91);r.a.CreateRibbon=function(t){var e=t.pathArray,i=t.closeArray||!1,o=t.closePath||!1,s=t.invertUV||!1,a=Math.floor(e[0].length/2),h=t.offset||a;h=h>a?a:Math.floor(h);var c,p,u,l,d=0===t.sideOrientation?0:t.sideOrientation||r.a.DEFAULTSIDE,f=t.uvs,y=t.colors,m=[],g=[],_=[],b=[],v=[],P=[],A=[],M=[],x=[],C=[];if(e.length<2){var I=[],S=[];for(u=0;u<e[0].length-h;u++)I.push(e[0][u]),S.push(e[0][u+h]);e=[I,S]}var w,B,O,V,j,D=0,E=o?1:0;for(c=e[0].length,p=0;p<e.length;p++){for(A[p]=0,v[p]=[0],c=c<(B=(w=e[p]).length)?c:B,l=0;l<B;)m.push(w[l].x,w[l].y,w[l].z),l>0&&(O=w[l].subtract(w[l-1]).length()+A[p],v[p].push(O),A[p]=O),l++;o&&(l--,m.push(w[0].x,w[0].y,w[0].z),O=w[l].subtract(w[0]).length()+A[p],v[p].push(O),A[p]=O),x[p]=B+E,C[p]=D,D+=B+E}var R,T,z=null,L=null;for(u=0;u<c+E;u++){for(M[u]=0,P[u]=[0],p=0;p<e.length-1;p++)V=e[p],j=e[p+1],u===c?(z=V[0],L=j[0]):(z=V[u],L=j[u]),O=L.subtract(z).length()+M[u],P[u].push(O),M[u]=O;i&&L&&z&&(V=e[p],j=e[0],u===c&&(L=j[0]),O=L.subtract(z).length()+M[u],M[u]=O)}if(f)for(p=0;p<f.length;p++)b.push(f[p].x,f[p].y);else for(p=0;p<e.length;p++)for(u=0;u<c+E;u++)R=0!=A[p]?v[p][u]/A[p]:0,T=0!=M[u]?P[u][p]/M[u]:0,s?b.push(T,R):b.push(R,T);for(var F=0,W=x[p=0]-1,Q=x[p+1]-1,k=W<Q?W:Q,N=C[1]-C[0],H=i?x.length:x.length-1;F<=k&&p<H;)g.push(F,F+N,F+1),g.push(F+N+1,F+1,F+N),(F+=1)===k&&(++p===x.length-1?(N=C[0]-C[p],W=x[p]-1,Q=x[0]-1):(N=C[p+1]-C[p],W=x[p]-1,Q=x[p+1]-1),F=C[p],k=W<Q?W+F:Q+F);if(r.a.ComputeNormals(m,g,_),o){var J=0,U=0;for(p=0;p<e.length;p++)J=3*C[p],U=p+1<e.length?3*(C[p+1]-1):_.length-3,_[J]=.5*(_[J]+_[U]),_[J+1]=.5*(_[J+1]+_[U+1]),_[J+2]=.5*(_[J+2]+_[U+2]),_[U]=_[J],_[U+1]=_[J+1],_[U+2]=_[J+2]}r.a._ComputeSides(d,m,g,_,b,t.frontUVs,t.backUVs);var X=null;if(y){X=new Float32Array(4*y.length);for(var G=0;G<y.length;G++)X[4*G]=y[G].r,X[4*G+1]=y[G].g,X[4*G+2]=y[G].b,X[4*G+3]=y[G].a}var Z=new r.a,K=new Float32Array(m),Y=new Float32Array(_),q=new Float32Array(b);return Z.indices=g,Z.positions=K,Z.normals=Y,Z.uvs=q,X&&Z.set(X,n.b.ColorKind),o&&(Z._idx=C),Z},s.a.CreateRibbon=function(t,e,i,o,s,n,r,a,c){return void 0===i&&(i=!1),void 0===r&&(r=!1),h.CreateRibbon(t,{pathArray:e,closeArray:i,closePath:o,offset:s,updatable:r,sideOrientation:a,instance:c},n)};var h=function(){function t(){}return t.CreateRibbon=function(t,e,i){void 0===i&&(i=null);var h=e.pathArray,c=e.closeArray,p=e.closePath,u=s.a._GetDefaultSideOrientation(e.sideOrientation),l=e.instance,d=e.updatable;if(l){var f=o.c.Vector3[0].setAll(Number.MAX_VALUE),y=o.c.Vector3[1].setAll(-Number.MAX_VALUE),m=l.getVerticesData(n.b.PositionKind);if(function(t){for(var e=h[0].length,i=l,o=0,n=i._originalBuilderSideOrientation===s.a.DOUBLESIDE?2:1,r=1;r<=n;++r)for(var a=0;a<h.length;++a){var c=h[a],p=c.length;e=e<p?e:p;for(var u=0;u<e;++u){var d=c[u];t[o]=d.x,t[o+1]=d.y,t[o+2]=d.z,f.minimizeInPlaceFromFloats(d.x,d.y,d.z),y.maximizeInPlaceFromFloats(d.x,d.y,d.z),o+=3}if(i._creationDataStorage&&i._creationDataStorage.closePath){d=c[0];t[o]=d.x,t[o+1]=d.y,t[o+2]=d.z,o+=3}}}(m),l._boundingInfo?l._boundingInfo.reConstruct(f,y,l._worldMatrix):l._boundingInfo=new a.a(f,y,l._worldMatrix),l.updateVerticesData(n.b.PositionKind,m,!1,!1),e.colors){for(var g=l.getVerticesData(n.b.ColorKind),_=0,b=0;_<e.colors.length;_++,b+=4){var v=e.colors[_];g[b]=v.r,g[b+1]=v.g,g[b+2]=v.b,g[b+3]=v.a}l.updateVerticesData(n.b.ColorKind,g,!1,!1)}if(e.uvs){for(var P=l.getVerticesData(n.b.UVKind),A=0;A<e.uvs.length;A++)P[2*A]=e.uvs[A].x,P[2*A+1]=e.uvs[A].y;l.updateVerticesData(n.b.UVKind,P,!1,!1)}if(!l.areNormalsFrozen||l.isFacetDataEnabled){var M=l.getIndices(),x=l.getVerticesData(n.b.NormalKind),C=l.isFacetDataEnabled?l.getFacetDataParameters():null;if(r.a.ComputeNormals(m,M,x,C),l._creationDataStorage&&l._creationDataStorage.closePath)for(var I=0,S=0,w=0;w<h.length;w++)I=3*l._creationDataStorage.idx[w],S=w+1<h.length?3*(l._creationDataStorage.idx[w+1]-1):x.length-3,x[I]=.5*(x[I]+x[S]),x[I+1]=.5*(x[I+1]+x[S+1]),x[I+2]=.5*(x[I+2]+x[S+2]),x[S]=x[I],x[S+1]=x[I+1],x[S+2]=x[I+2];l.areNormalsFrozen||l.updateVerticesData(n.b.NormalKind,x,!1,!1)}return l}var B=new s.a(t,i);B._originalBuilderSideOrientation=u,B._creationDataStorage=new s.b;var O=r.a.CreateRibbon(e);return p&&(B._creationDataStorage.idx=O._idx),B._creationDataStorage.closePath=p,B._creationDataStorage.closeArray=c,O.applyToMesh(B,d),B},t}()},152:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var o=i(30),s=i(3),n=function(){function t(e,i){if(void 0===i&&(i=t.DefaultPluginFactory()),this._physicsPlugin=i,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");e=e||new o.e(0,-9.807,0),this.setGravity(e),this.setTimeStep()}return t.DefaultPluginFactory=function(){throw s.a.WarnImport("CannonJSPlugin")},t.prototype.setGravity=function(t){this.gravity=t,this._physicsPlugin.setGravity(this.gravity)},t.prototype.setTimeStep=function(t){void 0===t&&(t=1/60),this._physicsPlugin.setTimeStep(t)},t.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},t.prototype.setSubTimeStep=function(t){void 0===t&&(t=0),this._subTimeStep=t},t.prototype.getSubTimeStep=function(){return this._subTimeStep},t.prototype.dispose=function(){this._impostors.forEach((function(t){t.dispose()})),this._physicsPlugin.dispose()},t.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},t.prototype.addImpostor=function(t){t.uniqueId=this._impostors.push(t),t.parent||this._physicsPlugin.generatePhysicsBody(t)},t.prototype.removeImpostor=function(t){var e=this._impostors.indexOf(t);e>-1&&(this._impostors.splice(e,1).length&&this.getPhysicsPlugin().removePhysicsBody(t))},t.prototype.addJoint=function(t,e,i){var o={mainImpostor:t,connectedImpostor:e,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(o),this._physicsPlugin.generateJoint(o)},t.prototype.removeJoint=function(t,e,i){var o=this._joints.filter((function(o){return o.connectedImpostor===e&&o.joint===i&&o.mainImpostor===t}));o.length&&this._physicsPlugin.removeJoint(o[0])},t.prototype._step=function(t){var e=this;this._impostors.forEach((function(t){t.isBodyInitRequired()&&e._physicsPlugin.generatePhysicsBody(t)})),t>.1?t=.1:t<=0&&(t=1/60),this._physicsPlugin.executeStep(t,this._impostors)},t.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},t.prototype.getImpostors=function(){return this._impostors},t.prototype.getImpostorForPhysicsObject=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].object===t)return this._impostors[e];return null},t.prototype.getImpostorWithPhysicsBody=function(t){for(var e=0;e<this._impostors.length;++e)if(this._impostors[e].physicsBody===t)return this._impostors[e];return null},t.prototype.raycast=function(t,e){return this._physicsPlugin.raycast(t,e)},t.Epsilon=.001,t}()},168:function(t,e,i){"use strict";i.d(e,"b",(function(){return u})),i.d(e,"a",(function(){return l}));var o=i(1),s=i(32),n=i(34),r=i(36),a=i(200),h=i(49),c=i(97),p=i(39),u=(i(217),i(218),function(t){function e(e,i,o,r,a,h,p){void 0===i&&(i=null),void 0===o&&(o=null),void 0===r&&(r=null);var u=t.call(this,e,i,o,r,a)||this;u.useVertexColor=h,u.useVertexAlpha=p,u.color=new s.a(1,1,1),u.alpha=1,r&&(u.color=r.color.clone(),u.alpha=r.alpha,u.useVertexColor=r.useVertexColor,u.useVertexAlpha=r.useVertexAlpha),u.intersectionThreshold=.1;var l={attributes:[n.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===p&&(l.needAlphaBlending=!1),h?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(n.b.ColorKind)):(l.uniforms.push("color"),u.color4=new s.b),u._colorShader=new c.a("colorShader",u.getScene(),"color",l),u}return Object(o.d)(e,t),e.prototype._addClipPlaneDefine=function(t){var e="#define "+t;-1===this._colorShader.options.defines.indexOf(e)&&this._colorShader.options.defines.push(e)},e.prototype._removeClipPlaneDefine=function(t){var e="#define "+t,i=this._colorShader.options.defines.indexOf(e);-1!==i&&this._colorShader.options.defines.splice(i,1)},e.prototype.isReady=function(){var e=this.getScene();return e.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),e.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),e.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),e.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),e.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),e.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady()&&t.prototype.isReady.call(this)},e.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(e.prototype,"material",{get:function(){return this._colorShader},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype._bind=function(t,e,i){if(!this._geometry)return this;var o=this._colorShader.getEffect(),s=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(o,s),!this.useVertexColor){var n=this.color,r=n.r,a=n.g,h=n.b;this.color4.set(r,a,h,this.alpha),this._colorShader.setColor4("color",this.color4)}return p.a.BindClipPlane(o,this.getScene()),this},e.prototype._draw=function(t,e,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var o=this.getScene().getEngine();return this._unIndexed?o.drawArraysType(h.a.LineListDrawMode,t.verticesStart,t.verticesCount,i):o.drawElementsType(h.a.LineListDrawMode,t.indexStart,t.indexCount,i),this},e.prototype.dispose=function(e){this._colorShader.dispose(!1,!1,!0),t.prototype.dispose.call(this,e)},e.prototype.clone=function(t,i,o){return void 0===i&&(i=null),new e(t,this.getScene(),i,this,o)},e.prototype.createInstance=function(t){return new l(t,this)},e}(r.a)),l=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o.intersectionThreshold=i.intersectionThreshold,o}return Object(o.d)(e,t),e.prototype.getClassName=function(){return"InstancedLinesMesh"},e}(a.a)},169:function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},172:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var o=i(30),s=i(4),n=i(115),r=i(124),a=i(34),h=i(43),c=i(173),p=i(102),u=i(203),l=i(48),d=function(){function t(t,e,i){var n=this;void 0===t&&(t=!0),void 0===e&&(e=Ammo),void 0===i&&(i=null),this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new o.b,this._tmpContactCallbackResult=!1,this._tmpVector=new o.e,this._tmpMatrix=new o.a,"function"==typeof e?e(this.bjsAMMO):this.bjsAMMO=e,this.isSupported()?(this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=i||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(){n._tmpContactCallbackResult=!0},this._raycastResult=new u.a,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)):s.a.Error("AmmoJS is not available. Please make sure you included the js file.")}return t.prototype.setGravity=function(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},t.prototype.setTimeStep=function(t){this._timeStep=t},t.prototype.setFixedTimeStep=function(t){this._fixedTimeStep=t},t.prototype.setMaxSteps=function(t){this._maxSteps=t},t.prototype.getTimeStep=function(){return this._timeStep},t.prototype._isImpostorInContact=function(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},t.prototype._isImpostorPairInContact=function(t,e){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,e.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},t.prototype._stepSimulation=function(t,e,i){if(void 0===t&&(t=1/60),void 0===e&&(e=10),void 0===i&&(i=1/60),0==e)this.world.stepSimulation(t,0);else for(;e>0&&t>0;)t-i<i?(this.world.stepSimulation(t,0),t=0):(t-=i,this.world.stepSimulation(i,0)),e--},t.prototype.executeStep=function(t,e){for(var i=0,o=e;i<o.length;i++){var s=o[i];s.soft||s.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var n=0,r=e;n<r.length;n++){var a=r[n];if(a.soft?this._afterSoftStep(a):a.afterStep(),a._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(a))for(var h=0,c=a._onPhysicsCollideCallbacks;h<c.length;h++)for(var p=0,u=c[h].otherImpostors;p<u.length;p++){var l=u[p];(a.physicsBody.isActive()||l.physicsBody.isActive())&&this._isImpostorPairInContact(a,l)&&(a.onCollide({body:l.physicsBody}),l.onCollide({body:a.physicsBody}))}}},t.prototype._afterSoftStep=function(t){t.type===n.a.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)},t.prototype._ropeStep=function(t){for(var e,i,s,n,r=t.physicsBody.get_m_nodes(),a=r.size(),h=new Array,u=0;u<a;u++)i=(e=r.at(u).get_m_x()).x(),s=e.y(),n=e.z(),h.push(new o.e(i,s,n));var l=t.object,d=t.getParam("shape");t._isFromLine?t.object=p.a.CreateLines("lines",{points:h,instance:l}):t.object=c.a.ExtrudeShape("ext",{shape:d,path:h,instance:l})},t.prototype._softbodyOrClothStep=function(t){var e=t.type===n.a.ClothImpostor?1:-1,i=t.object,o=i.getVerticesData(a.b.PositionKind);o||(o=[]);var s=i.getVerticesData(a.b.NormalKind);s||(s=[]);for(var r,c,p,u,l,d,f,y,m=o.length/3,g=t.physicsBody.get_m_nodes(),_=0;_<m;_++){var b;p=(c=(r=g.at(_)).get_m_x()).x(),u=c.y(),l=c.z()*e,d=(b=r.get_m_n()).x(),f=b.y(),y=b.z()*e,o[3*_]=p,o[3*_+1]=u,o[3*_+2]=l,s[3*_]=d,s[3*_+1]=f,s[3*_+2]=y}var v=new h.a;v.positions=o,v.normals=s,v.uvs=i.getVerticesData(a.b.UVKind),v.colors=i.getVerticesData(a.b.ColorKind),i&&i.getIndices&&(v.indices=i.getIndices()),v.applyToMesh(i)},t.prototype.applyImpulse=function(t,e,i){if(t.soft)s.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var n=this._tmpAmmoVectorA,r=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&(t.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.e.TransformCoordinatesToRef(i,this._tmpMatrix,this._tmpVector),i=this._tmpVector),n.setValue(i.x,i.y,i.z),r.setValue(e.x,e.y,e.z),t.physicsBody.applyImpulse(r,n)}},t.prototype.applyForce=function(t,e,i){if(t.soft)s.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var n=this._tmpAmmoVectorA,r=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&(t.object.getWorldMatrix().invertToRef(this._tmpMatrix),o.e.TransformCoordinatesToRef(i,this._tmpMatrix,this._tmpVector),i=this._tmpVector),n.setValue(i.x,i.y,i.z),r.setValue(e.x,e.y,e.z),t.physicsBody.applyForce(r,n)}},t.prototype.generatePhysicsBody=function(e){if(e._pluginData.toDispose=[],e.parent)e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());else if(e.isBodyInitRequired()){var i=this._createShape(e),o=e.getParam("mass");if(e._pluginData.mass=o,e.soft)i.get_m_cfg().set_collisions(17),i.get_m_cfg().set_kDP(e.getParam("damping")),this.bjsAMMO.castObject(i,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(e.getParam("margin")),i.setActivationState(t.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(i,1,-1),e.physicsBody=i,e._pluginData.toDispose.push(i),this.setBodyPressure(e,0),e.type===n.a.SoftbodyImpostor&&this.setBodyPressure(e,e.getParam("pressure")),this.setBodyStiffness(e,e.getParam("stiffness")),this.setBodyVelocityIterations(e,e.getParam("velocityIterations")),this.setBodyPositionIterations(e,e.getParam("positionIterations"));else{var s=new this.bjsAMMO.btVector3(0,0,0),r=new this.bjsAMMO.btTransform;r.setIdentity(),0!==o&&i.calculateLocalInertia(o,s),this._tmpAmmoVectorA.setValue(e.object.position.x,e.object.position.y,e.object.position.z),this._tmpAmmoQuaternion.setValue(e.object.rotationQuaternion.x,e.object.rotationQuaternion.y,e.object.rotationQuaternion.z,e.object.rotationQuaternion.w),r.setOrigin(this._tmpAmmoVectorA),r.setRotation(this._tmpAmmoQuaternion);var a=new this.bjsAMMO.btDefaultMotionState(r),h=new this.bjsAMMO.btRigidBodyConstructionInfo(o,a,i,s),c=new this.bjsAMMO.btRigidBody(h);0===o&&(c.setCollisionFlags(c.getCollisionFlags()|t.KINEMATIC_FLAG),c.setActivationState(t.DISABLE_DEACTIVATION_FLAG)),e.type!=n.a.NoImpostor||i.getChildShape||c.setCollisionFlags(c.getCollisionFlags()|t.DISABLE_COLLISION_FLAG),this.world.addRigidBody(c),e.physicsBody=c,e._pluginData.toDispose=e._pluginData.toDispose.concat([c,h,a,r,s,i])}this.setBodyRestitution(e,e.getParam("restitution")),this.setBodyFriction(e,e.getParam("friction"))}},t.prototype.removePhysicsBody=function(t){var e=this;this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach((function(t){e.bjsAMMO.destroy(t)})),t._pluginData.toDispose=[]))},t.prototype.generateJoint=function(t){var e=t.mainImpostor.physicsBody,i=t.connectedImpostor.physicsBody;if(e&&i){var n,a=t.joint.jointData;switch(a.mainPivot||(a.mainPivot=new o.e(0,0,0)),a.connectedPivot||(a.connectedPivot=new o.e(0,0,0)),t.joint.type){case r.a.DistanceJoint:var h=a.maxDistance;h&&(a.mainPivot=new o.e(0,-h/2,0),a.connectedPivot=new o.e(0,h/2,0)),n=new this.bjsAMMO.btPoint2PointConstraint(e,i,new this.bjsAMMO.btVector3(a.mainPivot.x,a.mainPivot.y,a.mainPivot.z),new this.bjsAMMO.btVector3(a.connectedPivot.x,a.connectedPivot.y,a.connectedPivot.z));break;case r.a.HingeJoint:a.mainAxis||(a.mainAxis=new o.e(0,0,0)),a.connectedAxis||(a.connectedAxis=new o.e(0,0,0));var c=new this.bjsAMMO.btVector3(a.mainAxis.x,a.mainAxis.y,a.mainAxis.z),p=new this.bjsAMMO.btVector3(a.connectedAxis.x,a.connectedAxis.y,a.connectedAxis.z);n=new this.bjsAMMO.btHingeConstraint(e,i,new this.bjsAMMO.btVector3(a.mainPivot.x,a.mainPivot.y,a.mainPivot.z),new this.bjsAMMO.btVector3(a.connectedPivot.x,a.connectedPivot.y,a.connectedPivot.z),c,p);break;case r.a.BallAndSocketJoint:n=new this.bjsAMMO.btPoint2PointConstraint(e,i,new this.bjsAMMO.btVector3(a.mainPivot.x,a.mainPivot.y,a.mainPivot.z),new this.bjsAMMO.btVector3(a.connectedPivot.x,a.connectedPivot.y,a.connectedPivot.z));break;default:s.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),n=new this.bjsAMMO.btPoint2PointConstraint(e,i,new this.bjsAMMO.btVector3(a.mainPivot.x,a.mainPivot.y,a.mainPivot.z),new this.bjsAMMO.btVector3(a.connectedPivot.x,a.connectedPivot.y,a.connectedPivot.z))}this.world.addConstraint(n,!t.joint.jointData.collision),t.joint.physicsJoint=n}},t.prototype.removeJoint=function(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)},t.prototype._addMeshVerts=function(t,e,i){var s=this,n=0;if(i&&i.getIndices&&i.getWorldMatrix&&i.getChildMeshes){var r=i.getIndices();r||(r=[]);var h=i.getVerticesData(a.b.PositionKind);h||(h=[]),i.computeWorldMatrix(!1);for(var c=r.length/3,p=0;p<c;p++){for(var u=[],l=0;l<3;l++){var d,f=new o.e(h[3*r[3*p+l]+0],h[3*r[3*p+l]+1],h[3*r[3*p+l]+2]);o.a.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,this._tmpMatrix),f=o.e.TransformCoordinates(f,this._tmpMatrix),(d=0==l?this._tmpAmmoVectorA:1==l?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),u.push(d)}t.addTriangle(u[0],u[1],u[2]),n++}i.getChildMeshes().forEach((function(i){n+=s._addMeshVerts(t,e,i)}))}return n},t.prototype._softVertexData=function(t){var e=t.object;if(e&&e.getIndices&&e.getWorldMatrix&&e.getChildMeshes){var i=e.getIndices();i||(i=[]);var s=e.getVerticesData(a.b.PositionKind);s||(s=[]);var n=e.getVerticesData(a.b.NormalKind);n||(n=[]),e.computeWorldMatrix(!1);for(var r=[],c=[],p=0;p<s.length;p+=3){var u=new o.e(s[p],s[p+1],s[p+2]),l=new o.e(n[p],n[p+1],n[p+2]);u=o.e.TransformCoordinates(u,e.getWorldMatrix()),l=o.e.TransformNormal(l,e.getWorldMatrix()),r.push(u.x,u.y,u.z),c.push(l.x,l.y,l.z)}var d=new h.a;return d.positions=r,d.normals=c,d.uvs=e.getVerticesData(a.b.UVKind),d.colors=e.getVerticesData(a.b.ColorKind),e&&e.getIndices&&(d.indices=e.getIndices()),d.applyToMesh(e),e.position=o.e.Zero(),e.rotationQuaternion=null,e.rotation=o.e.Zero(),e.computeWorldMatrix(!0),d}return h.a.ExtractFromMesh(e)},t.prototype._createSoftbody=function(t){var e=t.object;if(e&&e.getIndices){var i=e.getIndices();i||(i=[]);var s=this._softVertexData(t),n=s.positions,r=s.normals;if(null===n||null===r)return new this.bjsAMMO.btCompoundShape;for(var a=[],h=[],c=0;c<n.length;c+=3){var p=new o.e(n[c],n[c+1],n[c+2]),u=new o.e(r[c],r[c+1],r[c+2]);a.push(p.x,p.y,-p.z),h.push(u.x,u.y,-u.z)}var l=(new this.bjsAMMO.btSoftBodyHelpers).CreateFromTriMesh(this.world.getWorldInfo(),a,e.getIndices(),i.length/3,!0),d=n.length/3,f=l.get_m_nodes();for(c=0;c<d;c++){var y;(y=f.at(c).get_m_n()).setX(h[3*c]),y.setY(h[3*c+1]),y.setZ(h[3*c+2])}return l}},t.prototype._createCloth=function(t){var e=t.object;if(e&&e.getIndices){var i=e.getIndices();i||(i=[]);var o=this._softVertexData(t),s=o.positions,n=o.normals;if(null===s||null===n)return new this.bjsAMMO.btCompoundShape;var r=s.length,a=Math.sqrt(r/3);t.segments=a;var h=a-1;return this._tmpAmmoVectorA.setValue(s[0],s[1],s[2]),this._tmpAmmoVectorB.setValue(s[3*h],s[3*h+1],s[3*h+2]),this._tmpAmmoVectorD.setValue(s[r-3],s[r-2],s[r-1]),this._tmpAmmoVectorC.setValue(s[r-3-3*h],s[r-2-3*h],s[r-1-3*h]),(new this.bjsAMMO.btSoftBodyHelpers).CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,a,a,t.getParam("fixedPoints"),!0)}},t.prototype._createRope=function(t){var e,i,o=this._softVertexData(t),n=o.positions,r=o.normals;if(null===n||null===r)return new this.bjsAMMO.btCompoundShape;o.applyToMesh(t.object,!0),t._isFromLine=!0;if(0===r.map((function(t){return t*t})).reduce((function(t,e){return t+e})))i=(e=n.length)/3-1,this._tmpAmmoVectorA.setValue(n[0],n[1],n[2]),this._tmpAmmoVectorB.setValue(n[e-3],n[e-2],n[e-1]);else{t._isFromLine=!1;var a=t.getParam("path");if(null===t.getParam("shape"))return s.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;if(n.length%(3*a.length)!=0)return s.a.Warn("Path does not match extrusion"),new this.bjsAMMO.btCompoundShape;i=(e=a.length)-1,this._tmpAmmoVectorA.setValue(a[0].x,a[0].y,a[0].z),this._tmpAmmoVectorB.setValue(a[e-1].x,a[e-1].y,a[e-1].z)}t.segments=i;var h=t.getParam("fixedPoints");h=h>3?3:h;var c=(new this.bjsAMMO.btSoftBodyHelpers).CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,i-1,h);return c.get_m_cfg().set_collisions(17),c},t.prototype._createCustom=function(t){var e=null;return this.onCreateCustomShape&&(e=this.onCreateCustomShape(t)),null==e&&(e=new this.bjsAMMO.btCompoundShape),e},t.prototype._addHullVerts=function(t,e,i){var s=this,n=0;if(i&&i.getIndices&&i.getWorldMatrix&&i.getChildMeshes){var r=i.getIndices();r||(r=[]);var h=i.getVerticesData(a.b.PositionKind);h||(h=[]),i.computeWorldMatrix(!1);for(var c=r.length/3,p=0;p<c;p++){for(var u=[],l=0;l<3;l++){var d,f=new o.e(h[3*r[3*p+l]+0],h[3*r[3*p+l]+1],h[3*r[3*p+l]+2]);o.a.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,this._tmpMatrix),f=o.e.TransformCoordinates(f,this._tmpMatrix),(d=0==l?this._tmpAmmoVectorA:1==l?this._tmpAmmoVectorB:this._tmpAmmoVectorC).setValue(f.x,f.y,f.z),u.push(d)}t.addPoint(u[0],!0),t.addPoint(u[1],!0),t.addPoint(u[2],!0),n++}i.getChildMeshes().forEach((function(i){n+=s._addHullVerts(t,e,i)}))}return n},t.prototype._createShape=function(t,e){var i=this;void 0===e&&(e=!1);var r,a=t.object,h=t.getObjectExtendSize();if(!e){var c=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];r=new this.bjsAMMO.btCompoundShape;var p=0;if(c.forEach((function(t){var e=t.getPhysicsImpostor();if(e){if(e.type==n.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var s=i._createShape(e),a=t.parent.getWorldMatrix().clone(),h=new o.e;a.decompose(h),i._tmpAmmoTransform.getOrigin().setValue(t.position.x*h.x,t.position.y*h.y,t.position.z*h.z),i._tmpAmmoQuaternion.setValue(t.rotationQuaternion.x,t.rotationQuaternion.y,t.rotationQuaternion.z,t.rotationQuaternion.w),i._tmpAmmoTransform.setRotation(i._tmpAmmoQuaternion),r.addChildShape(i._tmpAmmoTransform,s),e.dispose(),p++}})),p>0){if(t.type!=n.a.NoImpostor){var u=this._createShape(t,!0);u&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),r.addChildShape(this._tmpAmmoTransform,u))}return r}this.bjsAMMO.destroy(r),r=null}switch(t.type){case n.a.SphereImpostor:if(l.a.WithinEpsilon(h.x,h.y,1e-4)&&l.a.WithinEpsilon(h.x,h.z,1e-4))r=new this.bjsAMMO.btSphereShape(h.x/2);else{var d=[new this.bjsAMMO.btVector3(0,0,0)];(r=new this.bjsAMMO.btMultiSphereShape(d,[1],1)).setLocalScaling(new this.bjsAMMO.btVector3(h.x/2,h.y/2,h.z/2))}break;case n.a.CapsuleImpostor:r=new this.bjsAMMO.btCapsuleShape(h.x/2,h.y/2);break;case n.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(h.x/2,h.y/2,h.z/2),r=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case n.a.PlaneImpostor:case n.a.BoxImpostor:this._tmpAmmoVectorA.setValue(h.x/2,h.y/2,h.z/2),r=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case n.a.MeshImpostor:if(0==t.getParam("mass")){var f=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(f);var y=this._addMeshVerts(f,a,a);r=0==y?new this.bjsAMMO.btCompoundShape:new this.bjsAMMO.btBvhTriangleMeshShape(f);break}case n.a.ConvexHullImpostor:var m=new this.bjsAMMO.btConvexHullShape;0==(y=this._addHullVerts(m,a,a))?(t._pluginData.toDispose.push(m),r=new this.bjsAMMO.btCompoundShape):r=m;break;case n.a.NoImpostor:r=new this.bjsAMMO.btSphereShape(h.x/2);break;case n.a.CustomImpostor:r=this._createCustom(t);break;case n.a.SoftbodyImpostor:r=this._createSoftbody(t);break;case n.a.ClothImpostor:r=this._createCloth(t);break;case n.a.RopeImpostor:r=this._createRope(t);break;default:s.a.Warn("The impostor type is not currently supported by the ammo plugin.")}return r},t.prototype.setTransformationFromPhysicsBody=function(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))},t.prototype.setPhysicsBodyTransformation=function(t,e,i){var o=t.physicsBody.getWorldTransform();if(o.getOrigin().x()!=e.x||o.getOrigin().y()!=e.y||o.getOrigin().z()!=e.z||o.getRotation().x()!=i.x||o.getRotation().y()!=i.y||o.getRotation().z()!=i.z||o.getRotation().w()!=i.w)if(this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),o.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(i.x,i.y,i.z,i.w),o.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(o),0==t.mass){var s=t.physicsBody.getMotionState();s&&s.setWorldTransform(o)}else t.physicsBody.activate()},t.prototype.isSupported=function(){return void 0!==this.bjsAMMO},t.prototype.setLinearVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},t.prototype.setAngularVelocity=function(t,e){this._tmpAmmoVectorA.setValue(e.x,e.y,e.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},t.prototype.getLinearVelocity=function(t){if(t.soft)var e=t.physicsBody.linearVelocity();else e=t.physicsBody.getLinearVelocity();if(!e)return null;var i=new o.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),i},t.prototype.getAngularVelocity=function(t){if(t.soft)var e=t.physicsBody.angularVelocity();else e=t.physicsBody.getAngularVelocity();if(!e)return null;var i=new o.e(e.x(),e.y(),e.z());return this.bjsAMMO.destroy(e),i},t.prototype.setBodyMass=function(t,e){t.soft?t.physicsBody.setTotalMass(e,!1):t.physicsBody.setMassProps(e),t._pluginData.mass=e},t.prototype.getBodyMass=function(t){return t._pluginData.mass||0},t.prototype.getBodyFriction=function(t){return t._pluginData.friction||0},t.prototype.setBodyFriction=function(t,e){t.soft?t.physicsBody.get_m_cfg().set_kDF(e):t.physicsBody.setFriction(e),t._pluginData.friction=e},t.prototype.getBodyRestitution=function(t){return t._pluginData.restitution||0},t.prototype.setBodyRestitution=function(t,e){t.physicsBody.setRestitution(e),t._pluginData.restitution=e},t.prototype.getBodyPressure=function(t){return t.soft?t._pluginData.pressure||0:(s.a.Warn("Pressure is not a property of a rigid body"),0)},t.prototype.setBodyPressure=function(t,e){t.soft?t.type===n.a.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(e),t._pluginData.pressure=e):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):s.a.Warn("Pressure can only be applied to a softbody")},t.prototype.getBodyStiffness=function(t){return t.soft?t._pluginData.stiffness||0:(s.a.Warn("Stiffness is not a property of a rigid body"),0)},t.prototype.setBodyStiffness=function(t,e){t.soft?(e=(e=e<0?0:e)>1?1:e,t.physicsBody.get_m_materials().at(0).set_m_kLST(e),t._pluginData.stiffness=e):s.a.Warn("Stiffness cannot be applied to a rigid body")},t.prototype.getBodyVelocityIterations=function(t){return t.soft?t._pluginData.velocityIterations||0:(s.a.Warn("Velocity iterations is not a property of a rigid body"),0)},t.prototype.setBodyVelocityIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_viterations(e),t._pluginData.velocityIterations=e):s.a.Warn("Velocity iterations cannot be applied to a rigid body")},t.prototype.getBodyPositionIterations=function(t){return t.soft?t._pluginData.positionIterations||0:(s.a.Warn("Position iterations is not a property of a rigid body"),0)},t.prototype.setBodyPositionIterations=function(t,e){t.soft?(e=e<0?0:e,t.physicsBody.get_m_cfg().set_piterations(e),t._pluginData.positionIterations=e):s.a.Warn("Position iterations cannot be applied to a rigid body")},t.prototype.appendAnchor=function(t,e,i,o,s,n){void 0===s&&(s=1),void 0===n&&(n=!1);var r=t.segments,a=Math.round((r-1)*i)+r*(r-1-Math.round((r-1)*o));t.physicsBody.appendAnchor(a,e.physicsBody,n,s)},t.prototype.appendHook=function(t,e,i,o,s){void 0===o&&(o=1),void 0===s&&(s=!1);var n=Math.round(t.segments*i);t.physicsBody.appendAnchor(n,e.physicsBody,s,o)},t.prototype.sleepBody=function(t){s.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},t.prototype.wakeUpBody=function(t){t.physicsBody.activate()},t.prototype.updateDistanceJoint=function(t,e,i){s.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},t.prototype.setMotor=function(t,e,i,o){t.physicsJoint.enableAngularMotor(!0,e,i)},t.prototype.setLimit=function(t,e,i){s.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},t.prototype.syncMeshWithImpostor=function(t,e){e.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},t.prototype.getRadius=function(t){return t.getObjectExtendSize().x/2},t.prototype.getBoxSizeToRef=function(t,e){var i=t.getObjectExtendSize();e.x=i.x,e.y=i.y,e.z=i.z},t.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},t.prototype.raycast=function(t,e){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(e.x,e.y,e.z);var i=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,i),this._raycastResult.reset(t,e),i.hasHit()&&(this._raycastResult.setHitData({x:i.get_m_hitNormalWorld().x(),y:i.get_m_hitNormalWorld().y(),z:i.get_m_hitNormalWorld().z()},{x:i.get_m_hitPointWorld().x(),y:i.get_m_hitPointWorld().y(),z:i.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(i),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},t.DISABLE_COLLISION_FLAG=4,t.KINEMATIC_FLAG=2,t.DISABLE_DEACTIVATION_FLAG=4,t}()},173:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var o=i(30),s=i(36),n=i(131),r=i(121);s.a.ExtrudeShape=function(t,e,i,o,n,r,h,c,p,u){void 0===h&&(h=null);var l={shape:e,path:i,scale:o,rotation:n,cap:0===r?0:r||s.a.NO_CAP,sideOrientation:p,instance:u,updatable:c};return a.ExtrudeShape(t,l,h)},s.a.ExtrudeShapeCustom=function(t,e,i,o,n,r,h,c,p,u,l,d){var f={shape:e,path:i,scaleFunction:o,rotationFunction:n,ribbonCloseArray:r,ribbonClosePath:h,cap:0===c?0:c||s.a.NO_CAP,sideOrientation:l,instance:d,updatable:u};return a.ExtrudeShapeCustom(t,f,p)};var a=function(){function t(){}return t.ExtrudeShape=function(e,i,o){void 0===o&&(o=null);var n=i.path,r=i.shape,a=i.scale||1,h=i.rotation||0,c=0===i.cap?0:i.cap||s.a.NO_CAP,p=i.updatable,u=s.a._GetDefaultSideOrientation(i.sideOrientation),l=i.instance||null,d=i.invertUV||!1;return t._ExtrudeShapeGeneric(e,r,n,a,h,null,null,!1,!1,c,!1,o,!!p,u,l,d,i.frontUVs||null,i.backUVs||null)},t.ExtrudeShapeCustom=function(e,i,o){void 0===o&&(o=null);var n=i.path,r=i.shape,a=i.scaleFunction||function(){return 1},h=i.rotationFunction||function(){return 0},c=i.ribbonCloseArray||!1,p=i.ribbonClosePath||!1,u=0===i.cap?0:i.cap||s.a.NO_CAP,l=i.updatable,d=s.a._GetDefaultSideOrientation(i.sideOrientation),f=i.instance,y=i.invertUV||!1;return t._ExtrudeShapeGeneric(e,r,n,null,null,a,h,c,p,u,!0,o,!!l,d,f||null,y,i.frontUVs||null,i.backUVs||null)},t._ExtrudeShapeGeneric=function(t,e,i,a,h,c,p,u,l,d,f,y,m,g,_,b,v,P){var A,M,x=function(t,e,i,n,r,a,h,c,p,u){for(var l=i.getTangents(),d=i.getNormals(),f=i.getBinormals(),y=i.getDistances(),m=0,g=u&&c?c:function(){return null!==a?a:0},_=u&&h?h:function(){return null!==r?r:1},b=p===s.a.NO_CAP||p===s.a.CAP_END?0:2,v=o.c.Matrix[0],P=0;P<e.length;P++){for(var A=new Array,M=g(P,y[P]),x=_(P,y[P]),C=0;C<t.length;C++){o.a.RotationAxisToRef(l[P],m,v);var I=l[P].scale(t[C].z).add(d[P].scale(t[C].x)).add(f[P].scale(t[C].y)),S=A[C]?A[C]:o.e.Zero();o.e.TransformCoordinatesToRef(I,v,S),S.scaleInPlace(x).addInPlace(e[P]),A[C]=S}n[b]=A,m+=M,b++}var w=function(t){var e,i=Array(),s=o.e.Zero();for(e=0;e<t.length;e++)s.addInPlace(t[e]);for(s.scaleInPlace(1/t.length),e=0;e<t.length;e++)i.push(s);return i};switch(p){case s.a.NO_CAP:break;case s.a.CAP_START:n[0]=w(n[2]),n[1]=n[2];break;case s.a.CAP_END:n[b]=n[b-1],n[b+1]=w(n[b-1]);break;case s.a.CAP_ALL:n[0]=w(n[2]),n[1]=n[2],n[b]=n[b-1],n[b+1]=w(n[b-1])}return n};if(_){var C=_._creationDataStorage;return A=C.path3D.update(i),M=x(e,i,C.path3D,C.pathArray,a,h,c,p,C.cap,f),_=s.a.CreateRibbon("",M,!1,!1,0,y||void 0,!1,0,_)}M=x(e,i,A=new r.d(i),new Array,a,h,c,p,d=d<0||d>3?0:d,f);var I=n.a.CreateRibbon(t,{pathArray:M,closeArray:u,closePath:l,updatable:m,sideOrientation:g,invertUV:b,frontUVs:v||void 0,backUVs:P||void 0},y);return I._creationDataStorage.pathArray=M,I._creationDataStorage.path3D=A,I._creationDataStorage.cap=d,I},t}()},199:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var o=i(1),s=i(30),n=i(34),r=i(36);r.a._GroundMeshParser=function(t,e){return a.Parse(t,e)};var a=function(t){function e(e,i){var o=t.call(this,e,i)||this;return o.generateOctree=!1,o}return Object(o.d)(e,t),e.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(e.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),e.prototype.optimize=function(t,e){void 0===e&&(e=32),this._subdivisionsX=t,this._subdivisionsY=t,this.subdivide(t);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(e)},e.prototype.getHeightAtCoordinates=function(t,e){var i=this.getWorldMatrix(),o=s.c.Matrix[5];i.invertToRef(o);var n=s.c.Vector3[8];if(s.e.TransformCoordinatesFromFloatsToRef(t,0,e,o,n),t=n.x,e=n.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var r=this._getFacetAt(t,e),a=-(r.x*t+r.z*e+r.w)/r.y;return s.e.TransformCoordinatesFromFloatsToRef(0,a,0,i,n),n.y},e.prototype.getNormalAtCoordinates=function(t,e){var i=new s.e(0,1,0);return this.getNormalAtCoordinatesToRef(t,e,i),i},e.prototype.getNormalAtCoordinatesToRef=function(t,e,i){var o=this.getWorldMatrix(),n=s.c.Matrix[5];o.invertToRef(n);var r=s.c.Vector3[8];if(s.e.TransformCoordinatesFromFloatsToRef(t,0,e,n,r),t=r.x,e=r.z,t<this._minX||t>this._maxX||e<this._minZ||e>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(t,e);return s.e.TransformNormalFromFloatsToRef(a.x,a.y,a.z,o,i),this},e.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},e.prototype._getFacetAt=function(t,e){var i=Math.floor((t+this._maxX)*this._subdivisionsX/this._width),o=Math.floor(-(e+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),s=this._heightQuads[o*this._subdivisionsX+i];return e<s.slope.x*t+s.slope.y?s.facet1:s.facet2},e.prototype._initHeightQuads=function(){var t=this._subdivisionsX,e=this._subdivisionsY;this._heightQuads=new Array;for(var i=0;i<e;i++)for(var o=0;o<t;o++){var n={slope:s.d.Zero(),facet1:new s.f(0,0,0,0),facet2:new s.f(0,0,0,0)};this._heightQuads[i*t+o]=n}return this},e.prototype._computeHeightQuads=function(){var t=this.getVerticesData(n.b.PositionKind);if(!t)return this;for(var e=s.c.Vector3[3],i=s.c.Vector3[2],o=s.c.Vector3[1],r=s.c.Vector3[0],a=s.c.Vector3[4],h=s.c.Vector3[5],c=s.c.Vector3[6],p=s.c.Vector3[7],u=s.c.Vector3[8],l=0,d=0,f=0,y=0,m=0,g=0,_=0,b=this._subdivisionsX,v=this._subdivisionsY,P=0;P<v;P++)for(var A=0;A<b;A++){l=3*A,d=P*(b+1)*3,f=(P+1)*(b+1)*3,e.x=t[d+l],e.y=t[d+l+1],e.z=t[d+l+2],i.x=t[d+l+3],i.y=t[d+l+4],i.z=t[d+l+5],o.x=t[f+l],o.y=t[f+l+1],o.z=t[f+l+2],r.x=t[f+l+3],r.y=t[f+l+4],r.z=t[f+l+5],y=(r.z-e.z)/(r.x-e.x),m=e.z-y*e.x,i.subtractToRef(e,a),o.subtractToRef(e,h),r.subtractToRef(e,c),s.e.CrossToRef(c,h,p),s.e.CrossToRef(a,c,u),p.normalize(),u.normalize(),g=-(p.x*e.x+p.y*e.y+p.z*e.z),_=-(u.x*i.x+u.y*i.y+u.z*i.z);var M=this._heightQuads[P*b+A];M.slope.copyFromFloats(y,m),M.facet1.copyFromFloats(p.x,p.y,p.z,g),M.facet2.copyFromFloats(u.x,u.y,u.z,_)}return this},e.prototype.serialize=function(e){t.prototype.serialize.call(this,e),e.subdivisionsX=this._subdivisionsX,e.subdivisionsY=this._subdivisionsY,e.minX=this._minX,e.maxX=this._maxX,e.minZ=this._minZ,e.maxZ=this._maxZ,e.width=this._width,e.height=this._height},e.Parse=function(t,i){var o=new e(t.name,i);return o._subdivisionsX=t.subdivisionsX||1,o._subdivisionsY=t.subdivisionsY||1,o._minX=t.minX,o._maxX=t.maxX,o._minZ=t.minZ,o._maxZ=t.maxZ,o._width=t.width,o._height=t.height,o},e}(r.a)},200:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var o=i(1),s=i(30),n=i(4),r=i(50),a=i(36),h=i(70),c=i(85),p=i(34);a.a._instancedMeshFactory=function(t,e){var i=new u(t,e);if(e.instancedBuffers)for(var o in i.instancedBuffers={},e.instancedBuffers)i.instancedBuffers[o]=e.instancedBuffers[o];return i};var u=function(t){function e(e,i){var o=t.call(this,e,i.getScene())||this;o._indexInSourceMeshInstanceArray=-1,i.addInstance(o),o._sourceMesh=i,o._unIndexed=i._unIndexed,o.position.copyFrom(i.position),o.rotation.copyFrom(i.rotation),o.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(o.rotationQuaternion=i.rotationQuaternion.clone()),o.animations=i.animations;for(var s=0,n=i.getAnimationRanges();s<n.length;s++){var r=n[s];null!=r&&o.createAnimationRange(r.name,r.from,r.to)}return o.infiniteDistance=i.infiniteDistance,o.setPivotMatrix(i.getPivotMatrix()),o.refreshBoundingInfo(),o._syncSubMeshes(),o}return Object(o.d)(e,t),e.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(e.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),e.prototype._resyncLightSources=function(){},e.prototype._resyncLightSource=function(t){},e.prototype._removeLightSource=function(t,e){},Object.defineProperty(e.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(t){this._sourceMesh&&t!==this._sourceMesh.renderingGroupId&&n.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),e.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},e.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(e.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),e.prototype.isReady=function(t){return void 0===t&&(t=!1),this._sourceMesh.isReady(t,!0)},e.prototype.getVerticesData=function(t,e){return this._sourceMesh.getVerticesData(t,e)},e.prototype.setVerticesData=function(t,e,i,o){return this.sourceMesh&&this.sourceMesh.setVerticesData(t,e,i,o),this.sourceMesh},e.prototype.updateVerticesData=function(t,e,i,o){return this.sourceMesh&&this.sourceMesh.updateVerticesData(t,e,i,o),this.sourceMesh},e.prototype.setIndices=function(t,e){return void 0===e&&(e=null),this.sourceMesh&&this.sourceMesh.setIndices(t,e),this.sourceMesh},e.prototype.isVerticesDataPresent=function(t){return this._sourceMesh.isVerticesDataPresent(t)},e.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(e.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),e.prototype.refreshBoundingInfo=function(t){if(void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var e=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(t),e),this},e.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},e.prototype._activate=function(t,e){if(this._sourceMesh.subMeshes||n.a.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,t),e){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},e.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},e.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==c.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var e=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,s.c.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),s.c.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(s.c.Vector3[7]),this._currentLOD._masterMesh=e,s.c.Matrix[0]}return t.prototype.getWorldMatrix.call(this)},Object.defineProperty(e.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.getLOD=function(t){if(!t)return this;var e=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(t,e.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},e.prototype._preActivateForIntermediateRendering=function(t){return this.sourceMesh._preActivateForIntermediateRendering(t)},e.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var t=0;t<this._sourceMesh.subMeshes.length;t++)this._sourceMesh.subMeshes[t].clone(this,this._sourceMesh);return this},e.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},e.prototype.clone=function(t,e,i){void 0===e&&(e=null);var o=this._sourceMesh.createInstance(t);if(h.a.DeepCopy(this,o,["name","subMeshes","uniqueId","parent"],[]),this.refreshBoundingInfo(),e&&(o.parent=e),!i)for(var s=0;s<this.getScene().meshes.length;s++){var n=this.getScene().meshes[s];n.parent===this&&n.clone(n.name,o)}return o.computeWorldMatrix(!0),o},e.prototype.dispose=function(e,i){void 0===i&&(i=!1),this._sourceMesh.removeInstance(this),t.prototype.dispose.call(this,e,i)},e}(r.a);a.a.prototype.registerInstancedBuffer=function(t,e){if(this.removeVerticesData(t),!this.instancedBuffers){this.instancedBuffers={};for(var i=0,o=this.instances;i<o.length;i++){o[i].instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[t]=null,this._userInstancedBuffersStorage.strides[t]=e,this._userInstancedBuffersStorage.sizes[t]=32*e,this._userInstancedBuffersStorage.data[t]=new Float32Array(this._userInstancedBuffersStorage.sizes[t]),this._userInstancedBuffersStorage.vertexBuffers[t]=new p.b(this.getEngine(),this._userInstancedBuffersStorage.data[t],t,!0,!1,e,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[t]);for(var s=0,n=this.instances;s<n.length;s++){n[s].instancedBuffers[t]=null}},a.a.prototype._processInstancedBuffers=function(t,e){var i=t.length;for(var o in this.instancedBuffers){for(var s=this._userInstancedBuffersStorage.sizes[o],n=this._userInstancedBuffersStorage.strides[o],r=(i+1)*n;s<r;)s*=2;this._userInstancedBuffersStorage.data[o].length!=s&&(this._userInstancedBuffersStorage.data[o]=new Float32Array(s),this._userInstancedBuffersStorage.sizes[o]=s,this._userInstancedBuffersStorage.vertexBuffers[o]&&(this._userInstancedBuffersStorage.vertexBuffers[o].dispose(),this._userInstancedBuffersStorage.vertexBuffers[o]=null));var a=this._userInstancedBuffersStorage.data[o],h=0;if(e)h+=n,(u=this.instancedBuffers[o]).toArray?u.toArray(a,h):u.copyToArray(a,h);for(var c=0;c<i;c++){var u;(u=t[c].instancedBuffers[o]).toArray?u.toArray(a,h):u.copyToArray(a,h),h+=n}this._userInstancedBuffersStorage.vertexBuffers[o]?this._userInstancedBuffersStorage.vertexBuffers[o].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[o]=new p.b(this.getEngine(),this._userInstancedBuffersStorage.data[o],o,!0,!1,n,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[o]))}},a.a.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var t in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[t]&&this._userInstancedBuffersStorage.vertexBuffers[t].dispose();this.instancedBuffers={}}},203:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var o=i(30),s=function(){function t(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.e.Zero(),this._hitPointWorld=o.e.Zero(),this._rayFromWorld=o.e.Zero(),this._rayToWorld=o.e.Zero()}return Object.defineProperty(t.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!0,configurable:!0}),t.prototype.setHitData=function(t,e){this._hasHit=!0,this._hitNormalWorld=new o.e(t.x,t.y,t.z),this._hitPointWorld=new o.e(e.x,e.y,e.z)},t.prototype.setHitDistance=function(t){this._hitDistance=t},t.prototype.calculateHitDistance=function(){this._hitDistance=o.e.Distance(this._rayFromWorld,this._hitPointWorld)},t.prototype.reset=function(t,e){void 0===t&&(t=o.e.Zero()),void 0===e&&(e=o.e.Zero()),this._rayFromWorld=t,this._rayToWorld=e,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=o.e.Zero(),this._hitPointWorld=o.e.Zero()},t}()},205:function(t,e,i){"use strict";var o=i(4),s=i(0),n=i(50),r=i(51),a=i(38),h=i(152),c=i(124);a.a.prototype.getPhysicsEngine=function(){return this._physicsEngine},a.a.prototype.enablePhysics=function(t,e){if(void 0===t&&(t=null),this._physicsEngine)return!0;var i=this._getComponent(r.a.NAME_PHYSICSENGINE);i||(i=new p(this),this._addComponent(i));try{return this._physicsEngine=new h.a(t,e),this._physicsTimeAccumulator=0,!0}catch(t){return o.a.Error(t.message),!1}},a.a.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)},a.a.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},a.a.prototype.deleteCompoundImpostor=function(t){var e=t.parts[0].mesh;e.physicsImpostor&&(e.physicsImpostor.dispose(),e.physicsImpostor=null)},a.a.prototype._advancePhysicsEngineStep=function(t){if(this._physicsEngine){var e=this._physicsEngine.getSubTimeStep();if(e>0)for(this._physicsTimeAccumulator+=t;this._physicsTimeAccumulator>e;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(e/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=e;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}},Object.defineProperty(n.a.prototype,"physicsImpostor",{get:function(){return this._physicsImpostor},set:function(t){var e=this;this._physicsImpostor!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsImpostor=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add((function(){e.physicsImpostor&&(e.physicsImpostor.dispose(),e.physicsImpostor=null)}))))},enumerable:!0,configurable:!0}),n.a.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},n.a.prototype.applyImpulse=function(t,e){return this.physicsImpostor?(this.physicsImpostor.applyImpulse(t,e),this):this},n.a.prototype.setPhysicsLinkWith=function(t,e,i,o){return this.physicsImpostor&&t.physicsImpostor?(this.physicsImpostor.createJoint(t.physicsImpostor,c.a.HingeJoint,{mainPivot:e,connectedPivot:i,nativeParams:o}),this):this};var p=function(){function t(t){var e=this;this.name=r.a.NAME_PHYSICSENGINE,this.scene=t,this.scene.onBeforePhysicsObservable=new s.a,this.scene.onAfterPhysicsObservable=new s.a,this.scene.getDeterministicFrameTime=function(){return e.scene._physicsEngine?1e3*e.scene._physicsEngine.getTimeStep():1e3/60}}return t.prototype.register=function(){},t.prototype.rebuild=function(){},t.prototype.dispose=function(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()},t}()},217:function(t,e,i){"use strict";var o=i(7),s=(i(65),i(62),"colorPixelShader"),n="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}";o.a.ShadersStore[s]=n},218:function(t,e,i){"use strict";var o=i(7),s=(i(52),i(67),i(53),i(54),i(55),i(63),"colorVertexShader"),n="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}";o.a.ShadersStore[s]=n},81:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var o=i(30),s=i(36),n=i(43);n.a.CreateSphere=function(t){for(var e=t.segments||32,i=t.diameterX||t.diameter||1,s=t.diameterY||t.diameter||1,r=t.diameterZ||t.diameter||1,a=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1,h=t.slice&&t.slice<=0?1:t.slice||1,c=0===t.sideOrientation?0:t.sideOrientation||n.a.DEFAULTSIDE,p=new o.e(i/2,s/2,r/2),u=2+e,l=2*u,d=[],f=[],y=[],m=[],g=0;g<=u;g++){for(var _=g/u,b=_*Math.PI*h,v=0;v<=l;v++){var P=v/l,A=P*Math.PI*2*a,M=o.a.RotationZ(-b),x=o.a.RotationY(A),C=o.e.TransformCoordinates(o.e.Up(),M),I=o.e.TransformCoordinates(C,x),S=I.multiply(p),w=I.divide(p).normalize();f.push(S.x,S.y,S.z),y.push(w.x,w.y,w.z),m.push(P,_)}if(g>0)for(var B=f.length/3,O=B-2*(l+1);O+l+2<B;O++)d.push(O),d.push(O+1),d.push(O+l+1),d.push(O+l+1),d.push(O+1),d.push(O+l+2)}n.a._ComputeSides(c,f,d,y,m,t.frontUVs,t.backUVs);var V=new n.a;return V.indices=d,V.positions=f,V.normals=y,V.uvs=m,V},s.a.CreateSphere=function(t,e,i,o,s,n){var a={segments:e,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:n,updatable:s};return r.CreateSphere(t,a,o)};var r=function(){function t(){}return t.CreateSphere=function(t,e,i){void 0===i&&(i=null);var o=new s.a(t,i);return e.sideOrientation=s.a._GetDefaultSideOrientation(e.sideOrientation),o._originalBuilderSideOrientation=e.sideOrientation,n.a.CreateSphere(e).applyToMesh(o,e.updatable),o},t}()}}]);
//# sourceMappingURL=2.babylonBundle.js.map